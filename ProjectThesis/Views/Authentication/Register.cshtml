@model ProjectThesis.ViewModels.RegisterStudentViewModel; 
@{
    Layout = "AuthenticationLayout";
}

<p>Utwórz konto, by mieć możliwość rezerwacji tematu pracy</p>

<form asp-controller="Authentication" asp-action="Register">
    <div class="form-group">
        <label asp-for="User.Email">E-mail</label>
        <input asp-for="User.Email" class="form-control">
        @Html.ValidationMessage("User.Email")
    </div>
    <div class="form-group">
        <label asp-for="User.Password">Hasło</label>
        <input asp-for="User.Password" type="password" class="form-control" aria-describedby="passwordHelp">
        @Html.ValidationMessage("User.Password")
    </div>
    <div class="form-group">
        <label>Powtórz hasło</label>
        <input name="ConfirmPassword" type="password" class="form-control" aria-describedby="passwordHelp">
        @Html.ValidationMessage("ConfirmPassword")
    </div>
    <div class="form-group">
        <label asp-for="User.FirstName">Imię</label>
        <input asp-for="User.FirstName" class="form-control">
        @Html.ValidationMessage("User.FirstName")
    </div>
    <div class="form-group">
        <label asp-for="User.LastName">Nazwisko</label>
        <input asp-for="User.LastName" class="form-control">
        @Html.ValidationMessage("User.LastName")
    </div>
    <div class="form-group">
        <label asp-for="Student.StudentNo">Nr albumu</label>
        <input asp-for="Student.StudentNo" class="form-control">
        @Html.ValidationMessage("Student.StudentNo")
    </div>
    <div class="form-group">
        <label asp-for="Student.DegreeCycle">Stopień studiów</label>
        <select asp-for="Student.DegreeCycle" class="form-control">
            <option value="0">I</option>
            <option value="1">II</option>
        </select>
        @Html.ValidationMessage("Student.DegreeCycle")
    </div>
    <div class="form-group">
        <label asp-for="Faculties">Wydział</label>
        @Html.DropDownListFor(
            model => model.Faculties,
            new SelectList(Model.Faculties, "Id", "Name"),
            "-- Wybierz wydział --",
            new { @class = "form-control", @onchange = "javascript:GetSpecialties(this.value);" }
        )
    </div>
    <div class="form-group">
        <label asp-for="Student.SpecialtyId">Kierunek</label>
        <select asp-for="Student.SpecialtyId" class="form-control">
        </select>
        @Html.ValidationMessage("Student.Specialty")
    </div>
    
    <button type="submit" class="btn btn-primary">Dokończ rejestrację</button>
</form>

<p>
    Masz już konto?
    <a asp-controller="Authentication" asp-action="Login"> Zaloguj się</a>
</p>

<script type="text/javascript">
    function GetSpecialties(faculty)
    {
        $.ajax({
            type: "GET",
            url: "@Url.Action("GetSpecialties", "Authentication")",
            data: { "facultyId": faculty },
            contentType: 'application/json; charset=utf-8',
            dataType: 'json',
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                alert("Request: " + XMLHttpRequest.toString() + "\n\nStatus: " + textStatus + "\n\nError: " + errorThrown);
            },
            success: function (specialties) {
                var dropdown = $('#Student_SpecialtyId');
                dropdown.empty();
                specialties.forEach(function (s) {
                    dropdown.append(
                        $('<option></option>').val(s.id).html(s.name)
                    );
                });
            }
        });
    }
</script>